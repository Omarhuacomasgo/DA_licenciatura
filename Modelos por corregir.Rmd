---
title: "Modlos polinomales por corregir"
author: "Omar Huaco"
date: "`r Sys.Date()`"
output: html_document
---



```{r message=FALSE, warning=FALSE}
modlist <- list(d2_churchill1OLS, d2_churchill2OLS, d2_churchill3OLS,  d2_churchill4OLS, d2_churchill5OLS, d2_churchill6OLS)
names(modlist) <- as.character(seq_along(modlist))
modelsummary(
  modlist, 
 statistic = "({std.error})", 
 stars     = TRUE, 
 output    = "E:/Rstudio projects/DA_licenciatura/Exports/Tables/D2churchill_HC3OLS.docx", 
 title     =  "Churchill – Modelos OLS HC3")


```



```{r, fig.height=8, fig.width=15}
# 1) Ajusta un único modelo con todos los polinomios y controles
library(estimatr)
library(ggeffects)
library(ggplot2)
library(patchwork)

# 1) Ajusta el modelo con polinomios
mod2_poly <- lm_robust(pd_b ~ poly(cl_index_c, 2) + poly(theta_nps_c, 2) + poly(edad_c, 2) +
         ideol + partyid + sexo + ned + empleo_bin + estrato,
  data    = cdl_t,
  se_type = "HC3"
)

# 2) Extrae predicciones para clientelismo y edad
pred_cl   <- ggpredict(mod2_poly, terms = "cl_index_c [all]")
pred_edad <- ggpredict(mod2_poly, terms = "edad_c     [all]")

# 3) Dibuja cada curva
p_cl <- ggplot(pred_cl, aes(x, predicted)) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2) +
  labs(x = "Clientelismo (centrado)",
       y = "Predicción-Democracia como mejor régimen",
       title = "Curvatura del efecto de clientelismo") +
  theme_minimal(base_size = 13)

p_edad <- ggplot(pred_edad, aes(x, predicted)) +
  geom_line(size = 1) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2) +
  labs(x = "Edad (centrada)",
       y = "Predicción-Democracia como mejor régimen",
       title = "Curvatura del efecto de edad") +
  theme_minimal(base_size = 13)

# 4) Combínalas y añade título general
(p_cl + p_edad) + plot_annotation(title = "Efectos cuadráticos (HC3)")

```